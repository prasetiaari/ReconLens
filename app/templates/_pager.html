{# templates/_pager.html #}
{# expects: page, total_pages, page_url, page_size #}

{% set p  = page|int %}
{% set tp = total_pages|int %}
{% set ps = page_size|int %}

<div class="pager flex items-center justify-between gap-4 text-sm">
  <!-- rows/page -->
  <div class="flex items-center gap-2">
    <span class="text-slate-600">rows/page</span>
    <form hx-get="{{ page_url }}" hx-target="#page" hx-select="#page" hx-push-url="true"
          class="inline-block">
      <select name="page_size" class="input py-1 px-2"
              onchange="this.form.requestSubmit()">
        {% for opt in [25, 50, 100, 200] %}
          <option value="{{ opt }}" {{ 'selected' if opt==ps else '' }}>{{ opt }}</option>
        {% endfor %}
      </select>
      {# keep current page when changing page_size by clamping to new total later #}
      <input type="hidden" name="page" value="{{ p }}">
    </form>
  </div>

  <!-- numeric pager -->
  <div class="flex items-center gap-2">
    {# Prev #}
    {% set prev_href = page_url ~ '?page=' ~ (p-1) ~ '&page_size=' ~ ps %}
    <a href="{{ prev_href }}"
       class="px-3 py-1 rounded-md border transition
              {{ 'text-slate-400 border-slate-200 pointer-events-none cursor-not-allowed' if p<=1 else 'hover:bg-slate-50 border-slate-300' }}">
      ‹ Prev
    </a>

    {# number window (7 buttons window) #}
    {% set window = 7 %}
    {% set half = (window // 2) %}
    {% set start = p - half %}
    {% if start < 1 %}{% set start = 1 %}{% endif %}
    {% set end = start + window - 1 %}
    {% if end > tp %}{% set end = tp %}{% set start = tp - window + 1 %}{% endif %}
    {% if start < 1 %}{% set start = 1 %}{% endif %}

    {# jump to 1 + ellipsis #}
    {% if start > 1 %}
      <a href="{{ page_url }}?page=1&page_size={{ ps }}" class="px-3 py-1 rounded-md border hover:bg-slate-50 border-slate-300">1</a>
      {% if start > 2 %}<span class="px-2 text-slate-400">…</span>{% endif %}
    {% endif %}

    {# main range #}
    {% for n in range(start, end + 1) %}
      {% set href = page_url ~ '?page=' ~ n ~ '&page_size=' ~ ps %}
      {% if n == p %}
        <span class="px-3 py-1 rounded-md bg-slate-900 text-white border border-slate-900">{{ n }}</span>
      {% else %}
        <a href="{{ href }}" class="px-3 py-1 rounded-md border hover:bg-slate-50 border-slate-300">{{ n }}</a>
      {% endif %}
    {% endfor %}

    {# ellipsis + jump to last #}
    {% if end < tp %}
      {% if end < tp-1 %}<span class="px-2 text-slate-400">…</span>{% endif %}
      <a href="{{ page_url }}?page={{ tp }}&page_size={{ ps }}" class="px-3 py-1 rounded-md border hover:bg-slate-50 border-slate-300">{{ tp }}</a>
    {% endif %}

    {# Next #}
    {% set next_href = page_url ~ '?page=' ~ (p+1) ~ '&page_size=' ~ ps %}
    <a href="{{ next_href }}"
       class="px-3 py-1 rounded-md border transition
              {{ 'text-slate-400 border-slate-200 pointer-events-none cursor-not-allowed' if p>=tp else 'hover:bg-slate-50 border-slate-300' }}">
      Next ›
    </a>
  </div>

  <!-- page info -->
  <div class="text-slate-500">Page {{ p }} / {{ tp }}</div>
</div>
