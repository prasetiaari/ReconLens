{# templates/_subdomains_rows.html #}

{# ---- ROWS ---- #}
{% for host in rows %}
  {% set rec = enrich.get(host) %}
  {# Bangun URL final: pakai scheme dari enrich kalau ada, default https #}
  {% set final_url = (rec.get('scheme') ~ '://' ~ host) if rec and rec.get('scheme') else ('https://' ~ host) %}

  <tr class="border-b last:border-0">
    <!-- URL (klik-able, open new tab) -->
    <td class="p-3 font-mono text-[13px] whitespace-nowrap overflow-hidden text-ellipsis">
      <a href="{{ final_url }}"
         target="_blank" rel="noopener"
         class="text-blue-700 underline decoration-dotted hover:decoration-solid block truncate max-w-full">
        {{ host }}
      </a>
    </td>

    <!-- status -->
    <td class="p-3">
      {% if rec %}
        {% if rec.get('alive') %}
          <span class="text-green-600">up</span>
        {% else %}
          <span class="text-rose-600">down</span>
        {% endif %}
      {% else %}
        <span class="text-slate-400">-</span>
      {% endif %}
    </td>

    <!-- last_probe (relative) -->
    <td class="p-3 text-xs text-slate-500">
      {% if rec and rec.get('last_probe') %}
        {{ rec.get('last_probe')|humantime }}
      {% else %}
        <span class="text-slate-400">-</span>
      {% endif %}
    </td>

    <!-- response_code -->
    <td class="p-3">
      {% if rec and rec.get('code') is not none %}
        {{ rec.get('code') }}
      {% else %}
        <span class="text-slate-400">None</span>
      {% endif %}
    </td>

    <!-- response_size -->
    <td class="p-3">
      {% if rec and rec.get('size') %}
        {{ rec.get('size')|humansize }}
      {% else %}
        <span class="text-slate-400">-</span>
      {% endif %}
    </td>

    <!-- title (ellipsis + tooltip) -->
    <td class="p-3 truncate">
      {% if rec and rec.get('title') %}
        <div class="truncate" title="{{ rec.get('title') }}">{{ rec.get('title') }}</div>
      {% else %}
        <span class="text-slate-400">-</span>
      {% endif %}
    </td>

    <!-- action (placeholder; nanti untuk probe ulang / screenshot / dll) -->
    <td class="p-3">
      <span class="text-slate-400">-</span>
    </td>
  </tr>
{% endfor %}

{# ---- PAGER (Out-of-band) ---- #}
{% include "_pager.html" %}
